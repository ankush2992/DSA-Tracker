<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DSA Tracker</title>
  <script>
    (function() {
      const THEME_KEY = 'dsa-theme';
      const BACKGROUND_KEY = 'dsa-theme-bg-index';
      const palette = [
        '#9FC088',
        '#91C4C3',
        '#9B5DE0',
        '#5D866C',
        '#BF092F',
        '#B0CE88',
        '#2F5755',
        '#5C3E94',
        '#FF3F7F',
        '#C2E2FA',
        '#E9D484'
      ];
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const storedTheme = localStorage.getItem(THEME_KEY);
      const initialTheme = storedTheme || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-bs-theme', initialTheme);
      document.documentElement.dataset.theme = initialTheme;
      if (initialTheme === 'dark') {
        let idx = Number.parseInt(localStorage.getItem(BACKGROUND_KEY), 10);
        if (Number.isNaN(idx) || idx < 0 || idx >= palette.length) {
          idx = 0;
          localStorage.setItem(BACKGROUND_KEY, idx);
        }
        const color = palette[idx];
        document.documentElement.style.setProperty('--dynamic-surface', color);
        if (document.body) {
          document.body.style.backgroundColor = color;
        }
      }
    })();
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    html[data-bs-theme='light'] {
      --brand-primary: #CC704B;
      --brand-primary-alt: #614124;
      --brand-accent: #9FC088;
      --brand-highlight: #E8C07D;
      --brand-surface: #f8f3ea;
      --brand-card: #fffaf3;
      --brand-border: #ead8c0;
      --brand-table-alt: rgba(159, 192, 136, 0.16);
      --text-strong: #3b2f23;
    }
    html[data-bs-theme='dark'] {
      --brand-primary: #E8C07D;
      --brand-primary-alt: #CC704B;
      --brand-accent: #9FC088;
      --brand-highlight: #9FC088;
      --brand-surface: #1b1410;
      --brand-card: #221812;
      --brand-border: #352519;
      --brand-table-alt: rgba(204, 112, 75, 0.18);
      --text-strong: #f8ead8;
    }
    body {
      padding-bottom: 60px;
      background-color: var(--dynamic-surface, var(--brand-surface));
      color: var(--text-strong);
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .navbar-brand { font-weight: 700; }
    .card {
      border-radius: 1rem;
      background-color: var(--brand-card);
      border-color: var(--brand-border);
      box-shadow: 0 18px 40px -24px rgba(97, 65, 36, 0.45);
      transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .table-light { background-color: rgba(232, 192, 125, 0.28) !important; }
    .table-hover tbody tr:hover { background-color: rgba(159, 192, 136, 0.22); }
    html[data-bs-theme='dark'] .table-light { background-color: rgba(204, 112, 75, 0.28) !important; }
    html[data-bs-theme='dark'] .table-hover tbody tr:hover { background-color: rgba(232, 192, 125, 0.22); }
    .table-striped tbody tr:nth-of-type(odd) { background-color: var(--brand-table-alt); }
    html[data-bs-theme='dark'] .badge.bg-success-subtle {
      background-color: rgba(159, 192, 136, 0.28) !important;
      color: #b6e0a5 !important;
    }
    html[data-bs-theme='dark'] .badge.bg-danger { background-color: rgba(204, 112, 75, 0.32) !important; }
    html[data-bs-theme='dark'] .badge.bg-secondary-subtle {
      background-color: rgba(97, 65, 36, 0.32) !important;
      color: #f1dcc7 !important;
    }
    .btn-gradient {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-highlight));
      border: none;
      color: #fff;
    }
    .btn-gradient:hover { filter: brightness(1.05); color: #fff; }
    nav.navbar {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-primary-alt)) !important;
    }
    html[data-bs-theme='dark'] nav.navbar {
      background: linear-gradient(135deg, #2a1c13, #432a1c) !important;
    }
    html[data-bs-theme='dark'] .nav-link { color: rgba(240, 232, 220, 0.85) !important; }
    html[data-bs-theme='dark'] .nav-link:hover { color: #fff !important; }
    .badge-pill {
      border-radius: 999px;
      padding: 0.35rem 0.75rem;
    }
    .text-accent { color: var(--brand-accent) !important; }
    .border-dashed { border-style: dashed !important; }
  </style>
</head>
<body>
<nav class="navbar navbar-dark bg-primary navbar-expand-lg mb-4">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('index') }}">DSA Tracker</a>
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="{{ url_for('topics_list') }}">Topics</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('problems_list') }}">Problems</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('reviews_board') }}">Review Board</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('sessions_list') }}">Sessions</a></li>
      <li class="nav-item ms-3">
        <button class="btn btn-sm btn-outline-light" id="theme-toggle" type="button">Dark Mode</button>
      </li>
    </ul>
  </div>
</nav>

<div class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mt-2">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% set asset_version = config.get('ASSET_VERSION') %}
{% if asset_version %}
  <script src="{{ url_for('static', filename='js/main.js', v=asset_version) }}"></script>
{% else %}
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endif %}
</body>
</html>
